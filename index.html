<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Alumni Connect Platform</title>

  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script src="https://cdn.tailwindcss.com"></script>

  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">

  <style>
    body { font-family: 'Inter', sans-serif; }
    body.dark-mode { background-color: #121212; color: #e0e0e0; }
    body.dark-mode a { color: #9ad1ff; }
    body.dark-mode .navbar { background-color: #1f1f1f !important; }
    body.dark-mode input, body.dark-mode textarea { background-color: #1f1f1f; color: #e0e0e0; border-color: #333; }
    body.dark-mode .bg-white { background-color: #1f1f1f !important; }
    body.dark-mode #home { background-color: #2d3748; }
    body.dark-mode #home h2, body.dark-mode #home p { color: #e0e0e0; }
    body.dark-mode #directory { background-color: #1a1a1a; }
    body.dark-mode #forum { background-color: #1a1a1a; }
    * { transition: all 0.3s ease; }
    .shadow-lg:hover { transform: translateY(-5px); box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2); }
    .fade-in { opacity: 0; transform: translateY(20px); transition: opacity 0.8s ease-out, transform 0.8s ease-out; }
    .fade-in.visible { opacity: 1; transform: translateY(0); }
    input:focus, textarea:focus { outline: none; border-color: #4f46e5; box-shadow: 0 0 5px rgba(79, 70, 229, 0.5); }
    #hero-container { display: flex; flex-direction: column; align-items: center; justify-content: center; min-height: 85vh; overflow: hidden; position: relative; }
    @media (min-width: 768px) { #hero-container { flex-direction: row; } }
    #animated-logo-container { position: relative; perspective: 1500px; display: flex; justify-content: center; align-items: center; }
    #company-logo { width: 100%; max-width: 350px; height: auto; opacity: 0; transform: rotateY(-45deg) scale(0.5); animation: holographic-reveal 3s forwards 0.5s; }
    #animated-logo-container::before { content: ''; position: absolute; bottom: 40px; width: 400px; height: 80px; background: radial-gradient(ellipse at center, rgba(79, 70, 229, 0.4) 0%, rgba(79, 70, 229, 0) 70%); border-radius: 50%; transform: rotateX(80deg); animation: projector-glow 4s infinite alternate; }
    #animated-logo-container::after { content: ''; position: absolute; top: 0; left: 0; width: 100%; height: 3px; background: #93c5fd; border-radius: 2px; box-shadow: 0 0 10px #93c5fd, 0 0 20px white; animation: scan-lines 4s cubic-bezier(0.23, 1, 0.32, 1) infinite; animation-delay: 3.5s; }
    @keyframes holographic-reveal { 0% { opacity: 0; filter: blur(20px); transform: rotateY(-45deg) scale(0.5) translateY(100px); } 50% { opacity: 0.8; filter: blur(8px); } 100% { opacity: 1; filter: blur(0); transform: rotateY(0deg) scale(1) translateY(0); } }
    @keyframes projector-glow { from { opacity: 0.6; transform: rotateX(80deg) scale(0.9); } to { opacity: 1; transform: rotateX(80deg) scale(1.1); } }
    @keyframes scan-lines { 0% { transform: translateY(0); opacity: 0; } 5% { opacity: 1; } 95% { opacity: 1; } 100% { transform: translateY(350px); opacity: 0; } }
  </style>
</head>

<body class="bg-gray-50 text-gray-800 transition-colors duration-300">

  <main id="main-content" class="hidden">
    <nav class="navbar flex items-center justify-between p-4 bg-blue-600 text-white shadow-md sticky top-0 z-50">
      <h1 class="text-2xl font-bold">Alumni Connect</h1>
      <div class="space-x-6 hidden md:flex">
        <a href="#home" class="hover:underline">Home</a>
        <a href="#forum" class="hover:underline">Forum</a>
        <a href="#directory" class="hover:underline">Directory</a>
      </div>
      <div>
        <span id="user-email" class="mr-4 text-sm"></span>
        <button id="logout-button" class="px-4 py-2 bg-red-600 rounded-lg hover:bg-red-700 text-sm">Logout</button>
      </div>
    </nav>

    <section id="home" class="bg-gray-200 text-gray-800 fade-in">
        <div id="hero-container" class="max-w-7xl mx-auto px-6">
          <div id="hero-text-content" class="text-center md:text-left md:w-1/2 md:pr-12">
            <h2 class="text-4xl lg:text-5xl font-bold mb-4">Welcome Back!</h2>
            <p class="text-lg mb-6">Connect with peers, join discussions, and stay engaged with your alumni network.</p>
          </div>
          <div id="animated-logo-container" class="w-full md:w-1/2 mt-12 md:mt-0">
            <img src="assets/logo.jpeg" alt="Company Logo" id="company-logo" />
          </div>
        </div>
      </section>

    <section id="forum" class="max-w-5xl mx-auto py-12 px-6 fade-in">
      <h3 class="text-2xl font-bold mb-6 border-b pb-2">Discussion Forum</h3>
      <div class="bg-white p-6 rounded-xl shadow-lg">
        <div id="messages-container" class="h-96 overflow-y-auto mb-4 p-4 border rounded-lg bg-gray-50 space-y-4">
          <p class="text-gray-500 text-center">Loading messages...</p>
        </div>
        <form id="message-form" class="flex gap-4">
          <input type="text" id="message-input" placeholder="Type your message..." class="flex-grow p-3 border rounded-lg" required disabled />
          <button type="submit" class="px-6 py-3 bg-blue-600 text-white font-semibold rounded-lg hover:bg-blue-700 disabled:bg-gray-400" disabled>Send</button>
        </form>
      </div>
    </section>

    <section id="directory" class="bg-gray-100 py-12 px-6 fade-in">
        <div class="max-w-5xl mx-auto">
          <h3 class="text-2xl font-bold mb-6 border-b pb-2">Alumni Directory</h3>
          <input type="text" id="alumni-search" placeholder="Search alumni by name, batch, or department..." class="w-full p-3 border rounded mb-6" />
          <div id="directory-grid" class="grid grid-cols-1 md:grid-cols-3 gap-6">
            <p class="col-span-3 text-center text-gray-500">Type in the search box to find alumni.</p>
          </div>
        </div>
    </section>
  </main>

  <section id="auth-section" class="flex items-center justify-center min-h-screen bg-gray-100">
    <div class="w-full max-w-md">
      <div class="bg-white p-8 rounded-2xl shadow-lg">
        <form id="login-form">
          <h2 class="text-2xl font-bold mb-6 text-center text-gray-800">Login</h2>
          <input type="email" id="login-email" placeholder="Email" class="w-full p-3 mb-4 border rounded" required />
          <input type="password" id="login-password" placeholder="Password" class="w-full p-3 mb-4 border rounded" required />
          <button type="submit" class="w-full py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700">Login</button>
          <p class="text-center text-sm mt-4 text-gray-600">Don't have an account? <a href="#" id="show-signup" class="text-blue-600 hover:underline">Sign up</a></p>
        </form>
        <form id="signup-form" class="hidden">
          <h2 class="text-2xl font-bold mb-6 text-center text-gray-800">Sign Up</h2>
          <input type="email" id="signup-email" placeholder="Email" class="w-full p-3 mb-4 border rounded" required />
          <input type="password" id="signup-password" placeholder="Password" class="w-full p-3 mb-4 border rounded" required />
          <button type="submit" class="w-full py-3 bg-green-600 text-white rounded-lg hover:bg-green-700">Sign Up</button>
          <p class="text-center text-sm mt-4 text-gray-600">Already have an account? <a href="#" id="show-login" class="text-blue-600 hover:underline">Login</a></p>
        </form>
      </div>
    </div>
  </section>
  
  <script>
    // --- 1. SUPABASE CLIENT SETUP ---
    const supabaseUrl = 'https://oriswzmkjvyesqlrpbya.supabase.co';
    const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im9yaXN3em1ranZ5ZXNxbHJwYnlhIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTc5MzA4OTMsImV4cCI6MjA3MzUwNjg5M30.YH3JEbMDL0r8FvmQ-KJtrKCVmJo5RslUKq90FkICvAE';
    const { createClient } = supabase;
    const _supabase = createClient(supabaseUrl, supabaseKey);

    // --- 2. SELECTORS FOR UI ELEMENTS ---
    const mainContent = document.getElementById('main-content');
    const authSection = document.getElementById('auth-section');
    const loginForm = document.getElementById('login-form');
    const signupForm = document.getElementById('signup-form');
    const showSignup = document.getElementById('show-signup');
    const showLogin = document.getElementById('show-login');
    const logoutButton = document.getElementById('logout-button');
    const messageForm = document.getElementById('message-form');
    const messageInput = document.getElementById('message-input');
    const messageSendButton = document.querySelector('#message-form button');
    const alumniSearchInput = document.getElementById('alumni-search');

    // --- 3. AUTHENTICATION LOGIC ---
    showSignup.addEventListener('click', (e) => { e.preventDefault(); loginForm.classList.add('hidden'); signupForm.classList.remove('hidden'); });
    showLogin.addEventListener('click', (e) => { e.preventDefault(); signupForm.classList.add('hidden'); loginForm.classList.remove('hidden'); });
    
    // Handle Signup
    signupForm.addEventListener('submit', async (e) => {
      e.preventDefault();
      const email = document.getElementById('signup-email').value;
      const password = document.getElementById('signup-password').value;
      
      const { data, error } = await _supabase.auth.signUp({ email, password });
      if (error) {
        alert('Error signing up: ' + error.message);
      } else {
        alert('Signup successful! You can now log in.');
        showLogin.click(); // Switch to login form
      }
    });

    // Handle Login
    loginForm.addEventListener('submit', async (e) => {
      e.preventDefault();
      const email = document.getElementById('login-email').value;
      const password = document.getElementById('login-password').value;
      
      const { data, error } = await _supabase.auth.signInWithPassword({ email, password });
      if (error) {
        alert('Error logging in: ' + error.message);
      }
      // The onAuthStateChange listener will handle showing the main content
    });

    // Handle Logout
    logoutButton.addEventListener('click', async (e) => {
      e.preventDefault();
      await _supabase.auth.signOut();
      // The onAuthStateChange listener will handle hiding the main content
    });

    // --- 4. ALUMNI SEARCH LOGIC ---
    function renderAlumni(alumniList) {
        const container = document.getElementById('directory-grid');
        container.innerHTML = '';
        if (alumniList.length === 0) {
            container.innerHTML = `<p class="col-span-3 text-center text-gray-500">No alumni found.</p>`;
            return;
        }
        alumniList.forEach(alumni => {
            container.innerHTML += `<div class="bg-white p-6 rounded-xl shadow-lg"><img src="https://via.placeholder.com/100" alt="profile" class="w-20 h-20 rounded-full mb-3" /><h4 class="text-lg font-semibold">${alumni.Name}</h4><p class="text-sm text-gray-500">Batch: ${alumni.Batch || 'N/A'} | Dept: ${alumni.Department || 'N/A'}</p><p class="text-sm mt-2">${alumni.Role || 'N/A'} @ ${alumni.Company || 'N/A'}</p></div>`;
        });
    }

    async function searchAlumni(searchTerm) {
        if (!searchTerm) {
            document.getElementById('directory-grid').innerHTML = `<p class="col-span-3 text-center text-gray-500">Type in the search box to find alumni.</p>`;
            return;
        }
        const { data, error } = await _supabase.from('alumni').select('*').or(`Name.ilike.%${searchTerm}%,Batch.ilike.%${searchTerm}%,Department.ilike.%${searchTerm}%`);
        if (error) { console.error('Search error:', error); return; }
        renderAlumni(data);
    }
    
    function debounce(func, delay) {
        let timeout;
        return function(...args) { clearTimeout(timeout); timeout = setTimeout(() => func.apply(this, args), delay); };
    }

    alumniSearchInput.addEventListener('input', debounce((e) => { searchAlumni(e.target.value.trim()); }, 300));

    // --- 5. SESSION & UI MANAGEMENT ---
    
    // Listen for changes in authentication state (login, logout)
    _supabase.auth.onAuthStateChange((event, session) => {
        if (session && session.user) {
            // User is logged in
            authSection.classList.add('hidden');
            mainContent.classList.remove('hidden');
            document.getElementById('user-email').textContent = session.user.email;
            
            // Enable chat form
            messageInput.disabled = false;
            messageSendButton.disabled = false;
            messageInput.placeholder = "Type your message...";
            
            // Placeholder for loading real messages
            // loadMessages();
        } else {
            // User is logged out
            mainContent.classList.add('hidden');
            authSection.classList.remove('hidden');
            
            // Disable chat form
            messageInput.disabled = true;
            messageSendButton.disabled = true;
            messageInput.placeholder = "Login to send a message...";
        }
    });
  </script>
</body>
</html>
